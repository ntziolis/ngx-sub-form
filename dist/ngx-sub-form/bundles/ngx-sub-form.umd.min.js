!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/forms"),require("rxjs"),require("rxjs/operators"),require("fast-deep-equal"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-sub-form",["exports","@angular/core","@angular/forms","rxjs","rxjs/operators","fast-deep-equal","@angular/common"],r):r((t=t||self)["ngx-sub-form"]={},t.ng.core,t.ng.forms,t.rxjs,t.rxjs.operators,t.isEqual,t.ng.common)}(this,(function(t,r,o,e,n,i,u){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var a=function(t,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(t,r)};function s(t,r){function o(){this.constructor=t}a(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}var l=function(){return(l=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var n in r=arguments[o])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function p(t,r,o,e){var n,i=arguments.length,u=i<3?r:null===e?e=Object.getOwnPropertyDescriptor(r,o):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,r,o,e);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(u=(i<3?n(u):i>3?n(r,o,u):n(r,o))||u);return i>3&&u&&Object.defineProperty(r,o,u),u}function f(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}function c(t){var r="function"==typeof Symbol&&t[Symbol.iterator],o=0;return r?r.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}function m(t,r){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var e,n,i=o.call(t),u=[];try{for(;(void 0===r||r-- >0)&&!(e=i.next()).done;)u.push(e.value)}catch(t){n={error:t}}finally{try{e&&!e.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return u}var h=new r.InjectionToken("NgxSubFormComponentToken");var y=function(t){return'"'+t+'"'},d=y,v=function(t){function r(r){return t.call(this,"Attempt to update the form value with an object that doesn't contains some of the required form control keys.\nMissing: "+r.map(y).join(", "))||this}return s(r,t),r}(Error),F=function(t){return function(r){return r.pipe(n.debounce((function(){return e.timer(t)})))}},g={debounce:F};function b(t){return function(r){var o=new e.Subject,i=t.ngOnDestroy;return t.ngOnDestroy=function(){i&&i.apply(t),o.next(),o.complete()},r.pipe(n.takeUntil(o))}}function G(t){return null==t}var V=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return s(r,t),r.prototype.setSubForm=function(t){this.subForm=t},r.prototype.emit=function(r){this.subForm&&(this.subForm.formGroup.updateValue({self:!0}),t.prototype.emit.call(this,this.subForm.formGroup.controlValue))},r}(r.EventEmitter),C=function(t){function r(r,o,e){var n=t.call(this,{})||this;return n.isRoot=!1,n.controlValue=r||void 0,n._valueChanges=new V,n.valueChanges=n._valueChanges,n.parentValidatorOrOpts=o,n.parentAsyncValidator=e,n}return s(r,t),r.prototype.setChangeDetector=function(t){this.cd=t},Object.defineProperty(r.prototype,"value",{get:function(){return this.controlValue},set:function(r){if(this.subForm){var o=r;this.controlValue=o,t.prototype.value=o}},enumerable:!0,configurable:!0}),r.prototype.setSubForm=function(t){var r=this;this.subForm=t,this._valueChanges.setSubForm(t),this.root===this&&(this.isRoot=!0),this.transformToFormGroup=function(t,o){return r.subForm.transformToFormGroup(t,o)||{}},this.transformFromFormGroup=this.subForm.transformFromFormGroup.bind(this.subForm),this.getDefaultValues=this.subForm.getDefaultValues.bind(this.subForm)},r.prototype.getRawValue=function(){var r=t.prototype.getRawValue.call(this);return this.transformFromFormGroup(r)},r.prototype.setValue=function(r,o){if(void 0===o&&(o={}),this.subForm){this.controlValue=r;var e=this.transformToFormGroup(r,{});this.subForm.handleFormArrayControls(e),t.prototype.patchValue.call(this,e,o)}else r&&(this.controlValue=r)},r.prototype.patchValue=function(r,o){if(void 0===o&&(o={}),!r)return this.setValue(r,o);if(this.subForm){this.controlValue=l(l({},this.controlValue),r);var e=this.transformToFormGroup(r,{});this.subForm.handleFormArrayControls(e),t.prototype.patchValue.call(this,e,o)}else r&&(this.controlValue=r)},r.prototype.reset=function(r,o){if(void 0===o&&(o={}),this.subForm){var e=this.getDefaultValues(),n=this.transformFromFormGroup(e);Array.isArray(r)||Array.isArray(n)?this.controlValue=r:this.controlValue=null!==r&&"object"==typeof r||null!==n&&"object"==typeof n?l(l({},n),r):r||n;var i=this.transformToFormGroup(this.controlValue,e);this.subForm.handleFormArrayControls(i),t.prototype.reset.call(this,i,o)}else r&&(this.controlValue=r)},r.prototype.getControlValue=function(t){var o=this;return t instanceof r?t.controlValue:t instanceof A?t.controls.map((function(t){return o.getControlValue(t)})):t.value},r.prototype.updateValue=function(t){var o;if(this.subForm){var e=this._reduceValue();if(this.controlValue=e,!((null===(o=t)||void 0===o?void 0:o.self)||this.isRoot)&&this.parent instanceof r)this.parent.updateValue(t)}},r.prototype._reduceValue=function(){var t,r;if(!this.subForm)return null;var o={};try{for(var e=c(Object.entries(this.subForm.formGroup.controls)),n=e.next();!n.done;n=e.next()){var i=m(n.value,2),u=i[0],a=i[1];o[u]=this.getControlValue(a)}}catch(r){t={error:r}}finally{try{n&&!n.done&&(r=e.return)&&r.call(e)}finally{if(t)throw t.error}}return this.transformFromFormGroup(o||{})},r}(o.FormGroup);function O(t,r){var o=r;if(!o.isPatched){var e=o.setValue.bind(o);o.setValue=function(r,o){e(r,o),t.updateValue(o)},o.isPatched=!0}}var A=function(t){function r(r,o,e,n){var i=t.call(this,o)||this;return i.isRoot=!1,i._valueChanges=new V,i.valueChanges=i._valueChanges,i.parentValidatorOrOpts=e,i.parentAsyncValidator=n,i.setSubForm(r),i}return s(r,t),r.prototype.setSubForm=function(t){var r=this;this.subForm=t,this._valueChanges.setSubForm(t),this.transformToFormGroup=function(t,o){return r.subForm.transformToFormGroup(t,o)||{}},this.transformFromFormGroup=this.subForm.transformFromFormGroup.bind(this.subForm),this.getDefaultValues=this.subForm.getDefaultValues.bind(this.subForm)},r.prototype.setValue=function(r,o){t.prototype.setValue.call(this,r,o),this.subForm.formGroup.updateValue(o)},r.prototype.patchValue=function(r,o){t.prototype.patchValue.call(this,r,o),this.subForm.formGroup.updateValue(o)},r.prototype.updateValue=function(t){this.subForm&&this.parent.updateValue(t)},r.prototype.removeAt=function(r){t.prototype.removeAt.call(this,r),this.subForm.formGroup.updateValue(void 0)},r}(o.FormArray);function _(t){return t.validate?function(r){return t.validate(r)}:t}function D(t){return t.validate?function(r){return t.validate(r)}:t}function S(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}function R(t){var r,e=S(t)?t.validators:t;return Array.isArray(e)?null!=(r=e)?o.Validators.compose(r.map(_)):null:e||null}function j(t,r){var e,n=S(r)?r.asyncValidators:t;return Array.isArray(n)?null!=(e=n)?o.Validators.composeAsync(e.map(D)):null:n||null}var w=function(){function t(){this.emitNullOnDestroy=!0,this.emitInitialValueOnInit=!0}return Object.defineProperty(t.prototype,"formControlNames",{get:function(){return this.mapControls((function(t,r){return r}),(function(){return!0}),!1)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if(void 0!==t.dataInput||void 0!==t.formGroup&&(!t.formGroup.firstChange||t.formGroup.currentValue)){if(!this.formGroup)throw new Error("The subForm input was not provided but is required.");if(!(this.formGroup instanceof C))throw new Error("The subForm input needs to be of type SubFormGroup.");var r=void 0!==t.dataInput;this._initializeFormGroup(r)}},t.prototype.ngAfterContentChecked=function(){var t;(null===(t=this.formGroup)||void 0===t?void 0:t.cd)&&(this.formGroup.parent?this.formGroup.cd.markForCheck():this.formGroup.cd.detectChanges())},t.prototype._initializeFormGroup=function(t){var r=this;void 0===t&&(t=!1),Object.keys(this.formGroup.controls).forEach((function(t){r.formGroup.removeControl(t)}));var e=this.formGroup,n=this.getFormControls();for(var i in n)if(n.hasOwnProperty(i)){var u=n[i];u instanceof o.FormControl&&O(e,u),this.formGroup.addControl(i,u)}e.setSubForm(this);var a=this.getFormGroupControlOptions(),s=[],p=[];e.parentValidatorOrOpts&&((f=R(e.parentValidatorOrOpts))&&s.push(f));e.parentAsyncValidator&&((f=j(e.parentAsyncValidator))&&p.push(f));if(a){var f;if(a.updateOn&&this.formGroup._setUpdateStrategy(a.updateOn),a.validators)(f=R(a.validators))&&s.push(f);if(a.asyncValidators)(f=j(a.asyncValidators))&&p.push(f)}s.length>0&&this.formGroup.setValidators(s),p.length>0&&this.formGroup.setAsyncValidators(p);var c,m=this.getDefaultValues(),h=this.transformFromFormGroup(m)||void 0,y=t?this.dataInput:e.controlValue;c=h&&y?Array.isArray(y)?y:Array.isArray(h)?h:l(l({},h),y):h||y;var d=this.transformToFormGroup(c,{});this.handleFormArrayControls(d),this.formGroup.reset(c,{onlySelf:!1,emitEvent:!1})},t.prototype.mapControls=function(t,r,e){if(void 0===r&&(r=function(){return!0}),void 0===e&&(e=!0),!this.formGroup)return null;var n=this.formGroup.controls,i={};for(var u in n)if(this.formGroup.controls.hasOwnProperty(u)){var a=n[u];if(e&&a instanceof o.FormArray){for(var s=[],l=0;l<a.length;l++)r(a.at(l),u,!0)&&s.push(t(a.at(l),u));s.length>0&&s.some((function(t){return!G(t)}))&&(i[u]=s)}else a&&r(a,u,!1)&&(i[u]=t(a,u))}return i},t.prototype.getFormGroupControlOptions=function(){return{}},t.prototype.getDefaultValues=function(){return{}},t.prototype.handleFormArrayControls=function(t){var r=this;this.formGroup&&Object.entries(t).forEach((function(t){var e=m(t,2),n=e[0],i=e[1];if(r.formGroup.get(n)instanceof o.FormArray&&Array.isArray(i)){for(var u=r.formGroup.get(n);u.length>i.length;)u.removeAt(u.length-1);for(var a=u.length;a<i.length;a++)if(r.formIsFormWithArrayControls())u.insert(a,r.createFormArrayControl(n,i[a]));else{var s=new o.FormControl(i[a]);O(r.formGroup,s),u.insert(a,s)}}}))},t.prototype.formIsFormWithArrayControls=function(){return"function"==typeof this.createFormArrayControl},t.prototype.handleEmissionRate=function(){return function(t){return t}},t.prototype.transformToFormGroup=function(t,r){return t||r||{}},t.prototype.transformFromFormGroup=function(t){return t},p([r.Input("subForm"),f("design:type",Object)],t.prototype,"formGroup",void 0),t=p([r.Directive()],t)}(),x=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return s(o,t),o=p([r.Directive()],o)}(w),I=function(t){function o(r){var o=t.call(this)||this;return o._dataOutput$=new e.Subject,o.emitInitialValueOnInit=!1,o.emitNullOnDestroy=!1,o.dataValue=null,o.formGroupInitialized=!1,o.formGroup=new C({}),r&&o.formGroup.setChangeDetector(r),o}return s(o,t),o.prototype.ngOnInit=function(){var t=this;this.formGroupInitialized||(this._initializeFormGroup(),this.formGroupInitialized=!0),this._dataOutput$.pipe(b(this),n.filter((function(){return t.formGroup.valid})),n.tap((function(r){return t.dataOutput.emit(r)}))).subscribe()},o.prototype.ngOnChanges=function(r){t.prototype.ngOnChanges.call(this,r),this.formGroupInitialized=!0},o.prototype.ngOnDestroy=function(){},o.prototype.onRegisterOnChangeHook=function(t){return!this.formGroup.invalid&&!i(t,this.dataInput)&&(this.dataValue=t,!0)},o.prototype.transformToFormGroup=function(t,r){return t},o.prototype.transformFromFormGroup=function(t){return t},o.prototype.manualSave=function(){this.dataValue=this.formGroup.controlValue,!G(this.dataValue)&&this.formGroup.valid&&this._dataOutput$.next(this.dataValue)},o.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},o=p([r.Directive(),f("design:paramtypes",[r.ChangeDetectorRef])],o)}(x),E=function(t){function o(r){return t.call(this,r)||this}return s(o,t),o.prototype.ngOnInit=function(){var r=this;t.prototype.ngOnInit.call(this);var o=this.formGroup.statusChanges.pipe(n.startWith(this.formGroup.status)),i=this.formGroup.valueChanges.pipe(n.startWith(this.formGroup.value));e.combineLatest([o,i]).pipe(b(this),n.filter((function(t){var r=m(t,2),o=r[0];r[1];return"VALID"===o})),n.tap((function(){return r.manualSave()}))).subscribe()},o.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},o=p([r.Directive(),f("design:paramtypes",[r.ChangeDetectorRef])],o)}(I),T=function(){function t(t){this.cd=t}return t.prototype.ngOnChanges=function(t){t.subForm&&this.subForm&&this.subForm.setChangeDetector(this.cd)},t.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},p([r.Input(),f("design:type",C)],t.prototype,"subForm",void 0),t=p([r.Directive({selector:"[subForm]"}),f("design:paramtypes",[r.ChangeDetectorRef])],t)}(),P=function(){function t(){}return t=p([r.NgModule({declarations:[T],imports:[u.CommonModule],exports:[T]})],t)}();t.MissingFormControlsError=v,t.NGX_SUB_FORM_HANDLE_VALUE_CHANGES_RATE_STRATEGIES=g,t.NgxAutomaticRootFormComponent=E,t.NgxRootFormComponent=I,t.NgxSubFormComponent=w,t.NgxSubFormModule=P,t.NgxSubFormRemapComponent=x,t.SubFormArray=A,t.SubFormDirective=T,t.SubFormGroup=C,t.isNullOrUndefined=G,t.patchFormControl=O,t.subformComponentProviders=function(t){return[{provide:o.NG_VALUE_ACCESSOR,useExisting:r.forwardRef((function(){return t})),multi:!0},{provide:o.NG_VALIDATORS,useExisting:r.forwardRef((function(){return t})),multi:!0},{provide:h,useExisting:r.forwardRef((function(){return t}))}]},t.takeUntilDestroyed=b,t.ɵ0=d,t.ɵ1=F,t.ɵa=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-sub-form.umd.min.js.map