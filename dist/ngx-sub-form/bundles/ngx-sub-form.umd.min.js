!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/forms"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("fast-deep-equal")):"function"==typeof define&&define.amd?define("ngx-sub-form",["exports","@angular/forms","@angular/core","rxjs","rxjs/operators","fast-deep-equal"],r):r((t=t||self)["ngx-sub-form"]={},t.ng.forms,t.ng.core,t.rxjs,t.rxjs.operators,t.isEqual)}(this,(function(t,r,o,e,n,i){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var u=function(t,r){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(t,r)};function a(t,r){function o(){this.constructor=t}u(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}function s(t,r,o,e){var n,i=arguments.length,u=i<3?r:null===e?e=Object.getOwnPropertyDescriptor(r,o):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,r,o,e);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(u=(i<3?n(u):i>3?n(r,o,u):n(r,o))||u);return i>3&&u&&Object.defineProperty(r,o,u),u}function p(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}function f(t,r){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var e,n,i=o.call(t),u=[];try{for(;(void 0===r||r-- >0)&&!(e=i.next()).done;)u.push(e.value)}catch(t){n={error:t}}finally{try{e&&!e.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return u}var l=new o.InjectionToken("NgxSubFormComponentToken");var c=function(t){return'"'+t+'"'},m=c,h=function(t){function r(r){return t.call(this,"Attempt to update the form value with an object that doesn't contains some of the required form control keys.\nMissing: "+r.map(c).join(", "))||this}return a(r,t),r}(Error),d=function(t){return function(r){return r.pipe(n.debounce((function(){return e.timer(t)})))}},y={debounce:d};function g(t){return function(r){var o=new e.Subject,i=t.ngOnDestroy;return t.ngOnDestroy=function(){i&&i.apply(t),o.next(),o.complete()},r.pipe(n.takeUntil(o))}}function v(t){return null==t}var b=function(){function t(){var t=this;this.controlKeys=[],this.formGroup=new r.FormGroup(this._getFormControls(),this.getFormGroupControlOptions()),this.onChange=void 0,this.onTouched=void 0,this.emitNullOnDestroy=!0,this.emitInitialValueOnInit=!0,this.subscription=void 0,this.controlDisabled=!1;var o=this.getDefaultValues();o&&this.formGroup.reset(o,{emitEvent:!1}),setTimeout((function(){t.formGroup&&(t.formGroup.updateValueAndValidity({emitEvent:!1}),t.controlDisabled&&t.formGroup.disable())}),0)}return Object.defineProperty(t.prototype,"formGroupControls",{get:function(){return this.formGroup?this.formGroup.controls:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formGroupValues",{get:function(){return this.mapControls((function(t){return t.value}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formGroupErrors",{get:function(){var t=this.mapControls((function(t){return t.errors}),(function(t,r,o){return!!o||t.invalid}),!0);return this.formGroup.errors||t&&Object.keys(t).length?Object.assign({},this.formGroup.errors?{formGroup:this.formGroup.errors}:{},t):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formControlNames",{get:function(){return this.mapControls((function(t,r){return r}),(function(){return!0}),!1)},enumerable:!0,configurable:!0}),t.prototype._getFormControls=function(){var t=this.getFormControls();return this.controlKeys=Object.keys(t),t},t.prototype.mapControls=function(t,o,e){if(void 0===o&&(o=function(){return!0}),void 0===e&&(e=!0),!this.formGroup)return null;var n=this.formGroup.controls,i={};for(var u in n)if(this.formGroup.controls.hasOwnProperty(u)){var a=n[u];if(e&&a instanceof r.FormArray){for(var s=[],p=0;p<a.length;p++)o(a.at(p),u,!0)&&s.push(t(a.at(p),u));s.length>0&&s.some((function(t){return!v(t)}))&&(i[u]=s)}else a&&o(a,u,!1)&&(i[u]=t(a,u))}return i},t.prototype.onFormUpdate=function(t){},t.prototype.getFormGroupControlOptions=function(){return{}},t.prototype.validate=function(){return!this.formGroup||this.formGroup.valid?null:this.formGroupErrors},t.prototype.ngOnDestroy=function(){this.formGroup=void 0,this.subscription&&this.subscription.unsubscribe(),this.emitNullOnDestroy&&this.onChange&&this.onChange(null),this.onChange=void 0},t.prototype.getDefaultValues=function(){return null},t.prototype.writeValue=function(t){if(this.formGroup){var r=this.getDefaultValues(),o=this.transformToFormGroup(void 0===t?null:t,r);if(v(o))this.formGroup.reset(null===r?void 0:r,{emitEvent:v(t)&&!v(r)});else{var e=this.getMissingKeys(o);if(e.length>0)throw new h(e);this.handleFormArrayControls(o);var n=this.formGroup.disabled;this.formGroup.setValue(o,{emitEvent:v(t)}),n&&this.formGroup.disable()}this.formGroup.markAsPristine(),this.formGroup.markAsUntouched()}},t.prototype.handleFormArrayControls=function(t){var o=this;Object.entries(t).forEach((function(t){var e=f(t,2),n=e[0],i=e[1];if(o.formGroup.get(n)instanceof r.FormArray&&Array.isArray(i)){for(var u=o.formGroup.get(n);u.length>i.length;)u.removeAt(u.length-1);for(var a=u.length;a<i.length;a++)o.formIsFormWithArrayControls()?u.insert(a,o.createFormArrayControl(n,i[a])):u.insert(a,new r.FormControl(i[a]))}}))},t.prototype.formIsFormWithArrayControls=function(){return"function"==typeof this.createFormArrayControl},t.prototype.getMissingKeys=function(t){return this.controlKeys.reduce((function(r,o){return(v(t)||void 0===t[o])&&r.push(o),r}),[])},t.prototype.handleEmissionRate=function(){return function(t){return t}},t.prototype.transformToFormGroup=function(t,r){return t},t.prototype.transformFromFormGroup=function(t){return t},t.prototype.registerOnChange=function(t){var r=this;if(this.formGroup){this.onChange=t;var o=Object.keys(this.formControlNames).map((function(t){return r.formGroup.controls[t].valueChanges.pipe(n.startWith(r.formGroup.controls[t].value),n.map((function(r){return{key:t,value:r}})))})),i=e.merge.apply(void 0,function(){for(var t=[],r=0;r<arguments.length;r++)t=t.concat(f(arguments[r]));return t}(o.map((function(t){return t.pipe(n.map((function(t){return t.key})))}))));this.subscription=this.formGroup.valueChanges.pipe(this.handleEmissionRate(),n.startWith(this.formGroup.value),n.delay(0),n.filter((function(){return!!r.formGroup})),n.withLatestFrom(i),n.map((function(t,o){var e=f(t,2),n=(e[0],e[1]);if(o>0&&r.onTouched&&r.onTouched(),o>0||0===o&&r.emitInitialValueOnInit){r.onChange&&r.onChange(r.transformFromFormGroup(r.formGroup.value));var i={};i[n]=!0,r.onFormUpdate(i)}}))).subscribe()}},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.setDisabledState=function(t){this.controlDisabled=!!t,this.formGroup&&(t?this.formGroup.disable({emitEvent:!1}):this.formGroup.enable({emitEvent:!1}))},t=s([o.Directive(),p("design:paramtypes",[])],t)}(),G=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r=s([o.Directive()],r)}(b),O=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.dataInput$=new e.BehaviorSubject(null),r._dataOutput$=new e.Subject,r.emitInitialValueOnInit=!1,r.emitNullOnDestroy=!1,r.dataValue=null,r}return a(r,t),Object.defineProperty(r.prototype,"disabled",{set:function(t){this.setDisabledState(t)},enumerable:!0,configurable:!0}),r.prototype.ngOnInit=function(){var t=this;this.registerOnChange((function(r){return t.onRegisterOnChangeHook(r)})),this.dataInput$.pipe(n.filter((function(r){return!i(r,t.formGroup.value)})),n.tap((function(r){v(r)||t.writeValue(r)})),g(this)).subscribe(),this._dataOutput$.pipe(n.filter((function(){return t.formGroup.valid})),n.tap((function(r){return t.dataOutput.emit(r)})),g(this)).subscribe()},r.prototype.onRegisterOnChangeHook=function(t){return!this.formGroup.invalid&&!i(t,this.dataInput$.value)&&(this.dataValue=t,!0)},r.prototype.dataInputUpdated=function(t){this.dataInput$.next(t)},r.prototype.writeValue=function(r){this.dataValue=r,t.prototype.writeValue.call(this,r)},r.prototype.transformToFormGroup=function(t,r){return t},r.prototype.transformFromFormGroup=function(t){return t},r.prototype.manualSave=function(){!v(this.dataValue)&&this.formGroup.valid&&this._dataOutput$.next(this.dataValue)},s([o.Input(),p("design:type",Object),p("design:paramtypes",[Object])],r.prototype,"disabled",null),r=s([o.Directive()],r)}(G),C=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.onRegisterOnChangeHook=function(r){return!!t.prototype.onRegisterOnChangeHook.call(this,r)&&(this.formGroup&&(this.formGroup.markAsPristine(),this.formGroup.valid&&this.manualSave()),!0)},r=s([o.Directive()],r)}(O),F=function(t){function r(r){return t.call(this,'You\'re trying to apply the "DataInput" decorator on a property called "'+r+'". That decorator should only be used on a property called "dataInput"')||this}return a(r,t),r}(Error);t.DataInput=function(){return function(t,r){if("dataInput"!==r)throw new F(r);Object.defineProperty(t,r,{set:function(t){this.dataInputUpdated(t)}})}},t.DataInputUsedOnWrongPropertyError=F,t.MissingFormControlsError=h,t.NGX_SUB_FORM_HANDLE_VALUE_CHANGES_RATE_STRATEGIES=y,t.NgxAutomaticRootFormComponent=C,t.NgxRootFormComponent=O,t.NgxSubFormComponent=b,t.NgxSubFormRemapComponent=G,t.isNullOrUndefined=v,t.subformComponentProviders=function(t){return[{provide:r.NG_VALUE_ACCESSOR,useExisting:o.forwardRef((function(){return t})),multi:!0},{provide:r.NG_VALIDATORS,useExisting:o.forwardRef((function(){return t})),multi:!0},{provide:l,useExisting:o.forwardRef((function(){return t}))}]},t.takeUntilDestroyed=g,t.ɵ0=m,t.ɵ1=d,t.ɵa=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-sub-form.umd.min.js.map