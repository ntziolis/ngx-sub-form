!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/forms"),require("rxjs"),require("rxjs/operators"),require("fast-deep-equal"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-sub-form",["exports","@angular/core","@angular/forms","rxjs","rxjs/operators","fast-deep-equal","@angular/common"],r):r((t=t||self)["ngx-sub-form"]={},t.ng.core,t.ng.forms,t.rxjs,t.rxjs.operators,t.isEqual,t.ng.common)}(this,(function(t,r,o,e,n,u,i){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var a=function(t,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(t,r)};function s(t,r){function o(){this.constructor=t}a(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}var l=function(){return(l=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var n in r=arguments[o])Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}).apply(this,arguments)};function p(t,r,o,e){var n,u=arguments.length,i=u<3?r:null===e?e=Object.getOwnPropertyDescriptor(r,o):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,r,o,e);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(i=(u<3?n(i):u>3?n(r,o,i):n(r,o))||i);return u>3&&i&&Object.defineProperty(r,o,i),i}function f(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}function c(t){var r="function"==typeof Symbol&&t[Symbol.iterator],o=0;return r?r.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}function m(t,r){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var e,n,u=o.call(t),i=[];try{for(;(void 0===r||r-- >0)&&!(e=u.next()).done;)i.push(e.value)}catch(t){n={error:t}}finally{try{e&&!e.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}return i}var h=new r.InjectionToken("NgxSubFormComponentToken");var y=function(t){return'"'+t+'"'},d=y,v=function(t){function r(r){return t.call(this,"Attempt to update the form value with an object that doesn't contains some of the required form control keys.\nMissing: "+r.map(y).join(", "))||this}return s(r,t),r}(Error),F=function(t){return function(r){return r.pipe(n.debounce((function(){return e.timer(t)})))}},g={debounce:F};function b(t){return function(r){var o=new e.Subject,u=t.ngOnDestroy;return t.ngOnDestroy=function(){u&&u.apply(t),o.next(),o.complete()},r.pipe(n.takeUntil(o))}}function V(t){return null==t}var G=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return s(r,t),r.prototype.setSubForm=function(t){var r=this;this.subForm=t,this.transformToFormGroup=function(t,o){return r.subForm.transformToFormGroup(t,o)||{}},this.transformFromFormGroup=this.subForm.transformFromFormGroup,this.getDefaultValues=this.subForm.getDefaultValues},r.prototype.emit=function(r){if(this.subForm){var o=this.transformToFormGroup(r,{});return t.prototype.emit.call(this,o)}},r}(r.EventEmitter),C=function(t){function r(r,o,e){var n=t.call(this,{})||this;return n.isRoot=!1,n.controlValue=r||void 0,n._valueChanges=new G,n.valueChanges=n._valueChanges,n.parentValidatorOrOpts=o,n.parentAsyncValidator=e,n}return s(r,t),r.prototype.setChangeDetector=function(t){this.cd=t},Object.defineProperty(r.prototype,"value",{get:function(){return this.controlValue},set:function(r){if(this.subForm){var o=this.transformToFormGroup(r,{});t.prototype.value=o,this.controlValue=r}},enumerable:!0,configurable:!0}),r.prototype.setSubForm=function(t){var r=this;this.subForm=t,this._valueChanges.setSubForm(t),this.root===this&&(this.isRoot=!0),this.transformToFormGroup=function(t,o){return r.subForm.transformToFormGroup(t,o)||{}},this.transformFromFormGroup=this.subForm.transformFromFormGroup,this.getDefaultValues=this.subForm.getDefaultValues},r.prototype.getRawValue=function(){var r=t.prototype.getRawValue.call(this);return this.transformFromFormGroup(r)},r.prototype.setValue=function(r,o){if(void 0===o&&(o={}),this.subForm){this.controlValue=l(l({},this.controlValue),r);var e=this.transformToFormGroup(r,{});this.subForm.handleFormArrayControls(this.controlValue),t.prototype.patchValue.call(this,e,o)}else r&&(this.controlValue=r)},r.prototype.patchValue=function(r,o){if(void 0===o&&(o={}),this.subForm){this.controlValue=l(l({},this.controlValue),r);var e=this.transformToFormGroup(r,{});this.subForm.handleFormArrayControls(this.controlValue),t.prototype.patchValue.call(this,e,o)}else r&&(this.controlValue=r)},r.prototype.reset=function(r,o){if(void 0===r&&(r={}),void 0===o&&(o={}),this.subForm){Array.isArray(r)?this.controlValue=r||[]:this.controlValue=l(l({},this.controlValue),r);var e=this.transformToFormGroup(r,this.getDefaultValues());this.subForm.handleFormArrayControls(this.controlValue),t.prototype.reset.call(this,e,o)}else r&&(this.controlValue=r)},r.prototype.updateValue=function(t){var o,e;if(this.subForm){var n={};try{for(var u=c(Object.entries(this.subForm.formGroup.controls)),i=u.next();!i.done;i=u.next()){var a=m(i.value,2),s=a[0],l=a[1];n[s]=l instanceof r?l.controlValue:l.value}}catch(t){o={error:t}}finally{try{i&&!i.done&&(e=u.return)&&e.call(u)}finally{if(o)throw o.error}}var p=this.transformFromFormGroup(n||{});if(this.controlValue=p,!this.isRoot)this.parent.updateValue(t)}},r}(o.FormGroup);function O(t,r){var o=r;if(!o.isPatched){var e=o.setValue.bind(o);o.setValue=function(r,o){e(r,o),t.updateValue(o)},o.isPatched=!0}}var A=function(t){function r(r,o,e,n){var u=t.call(this,o)||this;return u.isRoot=!1,u._valueChanges=new G,u.valueChanges=u._valueChanges,u.parentValidatorOrOpts=e,u.parentAsyncValidator=n,u.setSubForm(r),u}return s(r,t),r.prototype.setSubForm=function(t){var r=this;this.subForm=t,this._valueChanges.setSubForm(t),this.transformToFormGroup=function(t,o){return r.subForm.transformToFormGroup(t,o)||{}},this.transformFromFormGroup=this.subForm.transformFromFormGroup,this.getDefaultValues=this.subForm.getDefaultValues},r.prototype.setValue=function(r,o){t.prototype.setValue.call(this,r,o),this.subForm.formGroup.updateValue(o)},r.prototype.patchValue=function(r,o){t.prototype.patchValue.call(this,r,o),this.subForm.formGroup.updateValue(o)},r.prototype.updateValue=function(t){this.subForm&&this.parent.updateValue(t)},r.prototype.removeAt=function(r){t.prototype.removeAt.call(this,r),this.subForm.formGroup.updateValue(void 0)},r}(o.FormArray);function D(t){return t.validate?function(r){return t.validate(r)}:t}function S(t){return t.validate?function(r){return t.validate(r)}:t}function R(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}function _(t){var r,e=R(t)?t.validators:t;return Array.isArray(e)?null!=(r=e)?o.Validators.compose(r.map(D)):null:e||null}function j(t,r){var e,n=R(r)?r.asyncValidators:t;return Array.isArray(n)?null!=(e=n)?o.Validators.composeAsync(e.map(S)):null:n||null}var w=function(){function t(){this.emitNullOnDestroy=!0,this.emitInitialValueOnInit=!0}return Object.defineProperty(t.prototype,"formControlNames",{get:function(){return this.mapControls((function(t,r){return r}),(function(){return!0}),!1)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){var r=this;if(void 0!==t.dataInput||void 0!==t.formGroup){if(!this.formGroup)throw new Error("The subForm input was not provided but is required.");if(!(this.formGroup instanceof C))throw new Error("The subForm input needs to be of type SubFormGroup.");Object.keys(this.formGroup.controls).forEach((function(t){r.formGroup.removeControl(t)}));var e=this.formGroup,n=this.getFormControls();for(var u in n)if(n.hasOwnProperty(u)){var i=n[u];i instanceof o.FormControl&&O(e,i),this.formGroup.addControl(u,i)}e.setSubForm(this);var a=this.getFormGroupControlOptions(),s=[],p=[];if(e.parentValidatorOrOpts)(f=_(e.parentValidatorOrOpts))&&s.push(f);if(e.parentAsyncValidator)(f=j(e.parentAsyncValidator))&&p.push(f);if(a){var f;if(a.updateOn&&this.formGroup._setUpdateStrategy(a.updateOn),a.validators)(f=_(a.validators))&&s.push(f);if(a.asyncValidators)(f=j(a.asyncValidators))&&p.push(f)}s.length>0&&this.formGroup.setValidators(s),p.length>0&&this.formGroup.setAsyncValidators(p);var c,m=this.getDefaultValues(),h=this.transformFromFormGroup(m)||void 0;if(Array.isArray(h))c=e.controlValue;else{var y=(t.dataInput?this.dataInput:e.controlValue)||{};c=l(l({},h),y)}var d=this.transformToFormGroup(c,{});this.handleFormArrayControls(d),this.formGroup.reset(c,{onlySelf:!1,emitEvent:!1})}},t.prototype.ngAfterContentChecked=function(){var t;(null===(t=this.formGroup)||void 0===t?void 0:t.cd)&&(this.formGroup.parent?this.formGroup.cd.markForCheck():this.formGroup.cd.detectChanges())},t.prototype.mapControls=function(t,r,e){if(void 0===r&&(r=function(){return!0}),void 0===e&&(e=!0),!this.formGroup)return null;var n=this.formGroup.controls,u={};for(var i in n)if(this.formGroup.controls.hasOwnProperty(i)){var a=n[i];if(e&&a instanceof o.FormArray){for(var s=[],l=0;l<a.length;l++)r(a.at(l),i,!0)&&s.push(t(a.at(l),i));s.length>0&&s.some((function(t){return!V(t)}))&&(u[i]=s)}else a&&r(a,i,!1)&&(u[i]=t(a,i))}return u},t.prototype.getFormGroupControlOptions=function(){return{}},t.prototype.getDefaultValues=function(){return{}},t.prototype.handleFormArrayControls=function(t){var r=this;this.formGroup&&Object.entries(t).forEach((function(t){var e=m(t,2),n=e[0],u=e[1];if(r.formGroup.get(n)instanceof o.FormArray&&Array.isArray(u)){for(var i=r.formGroup.get(n);i.length>u.length;)i.removeAt(i.length-1);for(var a=i.length;a<u.length;a++)if(r.formIsFormWithArrayControls())i.insert(a,r.createFormArrayControl(n,u[a]));else{var s=new o.FormControl(u[a]);O(r.formGroup,s),i.insert(a,s)}}}))},t.prototype.formIsFormWithArrayControls=function(){return"function"==typeof this.createFormArrayControl},t.prototype.handleEmissionRate=function(){return function(t){return t}},t.prototype.transformToFormGroup=function(t,r){return t},t.prototype.transformFromFormGroup=function(t){return t},p([r.Input("subForm"),f("design:type",Object)],t.prototype,"formGroup",void 0),t=p([r.Directive()],t)}(),x=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return s(o,t),o=p([r.Directive()],o)}(w),E=function(t){function o(r){var o=t.call(this)||this;return o._dataOutput$=new e.Subject,o.emitInitialValueOnInit=!1,o.emitNullOnDestroy=!1,o.dataValue=null,o.formGroup=new C({}),r&&o.formGroup.setChangeDetector(r),o}return s(o,t),o.prototype.ngOnDestroy=function(){},o.prototype.ngOnInit=function(){var t=this;this._dataOutput$.pipe(b(this),n.filter((function(){return t.formGroup.valid})),n.tap((function(r){return t.dataOutput.emit(r)}))).subscribe()},o.prototype.onRegisterOnChangeHook=function(t){return!this.formGroup.invalid&&!u(t,this.dataInput)&&(this.dataValue=t,!0)},o.prototype.transformToFormGroup=function(t,r){return t},o.prototype.transformFromFormGroup=function(t){return t},o.prototype.manualSave=function(){this.dataValue=this.formGroup.controlValue,!V(this.dataValue)&&this.formGroup.valid&&this._dataOutput$.next(this.dataValue)},o.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},o=p([r.Directive(),f("design:paramtypes",[r.ChangeDetectorRef])],o)}(x),T=function(t){function o(r){return t.call(this,r)||this}return s(o,t),o.prototype.ngOnInit=function(){var r=this;t.prototype.ngOnInit.call(this);var o=this.formGroup.statusChanges.pipe(n.startWith(this.formGroup.status)),u=this.formGroup.valueChanges.pipe(n.startWith(this.formGroup.value));e.combineLatest([o,u]).pipe(b(this),n.filter((function(t){var r=m(t,2),o=r[0];r[1];return"VALID"===o})),n.tap((function(){return r.manualSave()}))).subscribe()},o.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},o=p([r.Directive(),f("design:paramtypes",[r.ChangeDetectorRef])],o)}(E),I=function(){function t(t){this.cd=t}return t.prototype.ngOnChanges=function(t){t.subForm&&this.subForm&&this.subForm.setChangeDetector(this.cd)},t.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},p([r.Input(),f("design:type",C)],t.prototype,"subForm",void 0),t=p([r.Directive({selector:"[subForm]"}),f("design:paramtypes",[r.ChangeDetectorRef])],t)}(),P=function(){function t(){}return t=p([r.NgModule({declarations:[I],imports:[i.CommonModule],exports:[I]})],t)}();t.MissingFormControlsError=v,t.NGX_SUB_FORM_HANDLE_VALUE_CHANGES_RATE_STRATEGIES=g,t.NgxAutomaticRootFormComponent=T,t.NgxRootFormComponent=E,t.NgxSubFormComponent=w,t.NgxSubFormModule=P,t.NgxSubFormRemapComponent=x,t.SubFormArray=A,t.SubFormDirective=I,t.SubFormGroup=C,t.isNullOrUndefined=V,t.patchFormControl=O,t.subformComponentProviders=function(t){return[{provide:o.NG_VALUE_ACCESSOR,useExisting:r.forwardRef((function(){return t})),multi:!0},{provide:o.NG_VALIDATORS,useExisting:r.forwardRef((function(){return t})),multi:!0},{provide:h,useExisting:r.forwardRef((function(){return t}))}]},t.takeUntilDestroyed=b,t.ɵ0=d,t.ɵ1=F,t.ɵa=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-sub-form.umd.min.js.map