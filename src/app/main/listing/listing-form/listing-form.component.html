<mat-card>
  <mat-card-header>
    <mat-card-title data-title [class.not-visible]="!formGroup.controls.title.value">
      {{ formGroup.controls.title.value }}
    </mat-card-title>
    <mat-card-subtitle data-price [class.not-visible]="!formGroup.controls.price.value">
      Â£{{ formGroup.controls.price.value | number }}
    </mat-card-subtitle>
  </mat-card-header>
  <div class="img-container">
    <img
      *ngIf="formGroup.controls.imageUrl.value"
      mat-card-image
      [src]="formGroup.controls.imageUrl.value"
      alt="Photo of {{ formGroup.controls.title.value }}"
    />
  </div>
  <mat-card-content>
    <form [formGroup]="formGroup">
      <mat-form-field>
        <input
          matInput
          data-input-id
          type="text"
          placeholder="ID"
          [formControlName]="formControlNames.id"
          autocomplete="off"
        />
      </mat-form-field>

      <!-- this is useful to make sure the type of the error is correct -->
      <!-- as it could be either an object or an array and AoT would notice if not correctly typed -->
      <mat-error data-input-id-error *ngIf="formGroup.controls.id.errors?.required">
        ID is required
      </mat-error>

      <mat-form-field>
        <input
          matInput
          data-input-title
          type="text"
          placeholder="Title"
          [formControlName]="formControlNames.title"
          autocomplete="off"
        />
      </mat-form-field>

      <mat-error data-input-title-error *ngIf="formGroup.controls.title.errors?.required">
        Title is required
      </mat-error>

      <mat-form-field>
        <input
          matInput
          data-input-image-url
          type="text"
          placeholder="Image Url"
          [formControlName]="formControlNames.imageUrl"
          autocomplete="off"
        />
      </mat-form-field>

      <mat-error data-input-image-url-error *ngIf="formGroup.controls.imageUrl.errors?.required">
        Image url is required
      </mat-error>

      <mat-form-field>
        <input
          matInput
          data-input-price
          type="number"
          placeholder="Price"
          [formControlName]="formControlNames.price"
          autocomplete="off"
        />
      </mat-form-field>

      <mat-error data-input-price-error *ngIf="formGroup.controls.price.errors?.required">
        Price is required
      </mat-error>

      <mat-form-field>
        <mat-select
          data-select-listing-type
          placeholder="Select listing type"
          [formControlName]="formControlNames.listingType"
        >
          <mat-option
            data-select-listing-type-option
            *ngFor="let listingType of ListingType | keyvalue"
            [value]="listingType.value"
          >
            {{ listingType.value }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div [ngSwitch]="formGroup.controls.listingType.value">
        <app-droid-product
          *ngSwitchCase="ListingType.DROID"
          [subForm]="formGroup.controls.droidProduct"
        ></app-droid-product>

        <app-vehicle-product
          *ngSwitchCase="ListingType.VEHICLE"
          [subForm]="formGroup.controls.vehicleProduct"
        ></app-vehicle-product>
      </div>
    </form>
  </mat-card-content>
  <mat-card-actions>
    <button
      mat-raised-button
      color="primary"
      (click)="manualSave()"
      [disabled]="formGroup.invalid || formGroup.disabled"
    >
      Upsert
    </button>

    <div *ngIf="formGroup.invalid" class="invalid-form">
      Form is invalid
    </div>
  </mat-card-actions>
</mat-card>

<mat-card class="errors">
  <mat-card-title>Form errors</mat-card-title>

  <mat-card-content>
    <!--
      this is an important test as we want to make sure that `formGroupErrors` is null when there's no error
      if we return an empty object the `*ngIf` condition would be considered valid
    -->  
    <pre *ngIf="formGroup.errors as errors; else noError" data-errors>{{ errors | json }}</pre>

    <ng-template #noError>
      <span data-no-error>
        Form is valid, no error!
      </span>
    </ng-template>
  </mat-card-content>
</mat-card>

<mat-card class="values">
  <mat-card-title>Control values</mat-card-title>

  <mat-card-content>
    <pre>{{ $any(this.formGroup).controlValue | json }}</pre>
  </mat-card-content>
</mat-card>

<mat-card class="values">
  <mat-card-title>Form values</mat-card-title>

  <mat-card-content>
    <pre>{{ formGroup.value | json }}</pre>
  </mat-card-content>
</mat-card>
